!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.effection=t():e.effection=t()}(self,(function(){return(()=>{var e={220:(e,t,r)=>{e.exports=r(399)},734:(e,t,r)=>{"use strict";r.d(t,{m:()=>s});var n=r(304),o=r(757),i=r(187);function s(e={}){let t=new i.EventEmitter;e.maxSubscribers?t.setMaxListeners(e.maxSubscribers):t.setMaxListeners(1e5);let r=(0,n.C)((e=>function*(r){let n=(0,o.on)(t,"event").subscribe(r);for(;;){let{value:t}=yield n.next();if(t.done)return t.value;e(t.value)}}),e.name);return{send:e=>{t.emit("event",{done:!1,value:e})},close:(...e)=>{t.emit("event",{done:!0,value:e[0]})},stream:r,...r}}},141:(e,t,r)=>{"use strict";r.d(t,{O:()=>i});var n=r(904),o=r(599);function i(){return{name:"AbortSignal",*init(){let e=new o.AbortController;return yield(0,n.C)((function*(){try{yield}finally{e.abort()}}),{labels:{name:"ensure signal aborted"}}),e.signal}}}},768:(e,t,r)=>{"use strict";r.d(t,{NO:()=>i,EG:()=>s,ol:()=>a});var n=r(934),o=r(700);function i(){return s((0,o.u)("future"))}function s(e){let t,r,o=[];function i(t){o.push(t),e.run(s)}function s(){if(t)for(;;){let e=o.shift();if(!e)break;e(t)}}function a(r){t||(t=r,e.run(s))}function u(){return r||(r=new Promise(((e,t)=>{i((r=>{"completed"===r.state?e(r.value):"errored"===r.state?t(r.error):"halted"===r.state&&t(new n.R6)}))})))}return{produce:a,future:{get state(){return(null==t?void 0:t.state)||"pending"},consume:i,then:(...e)=>u().then(...e),catch:(...e)=>u().catch(...e),finally:(...e)=>u().finally(...e),[Symbol.toStringTag]:"[continuation]"},resolve:e=>a({state:"completed",value:e}),reject:e=>a({state:"errored",error:e}),halt:()=>a({state:"halted"})}}const a={resolve(e){let{future:t,resolve:r}=i();return r(e),t},reject(e){let{future:t,reject:r}=i();return r(e),t},halt(){let{future:e,halt:t}=i();return t(),e}}},934:(e,t,r)=>{"use strict";r.d(t,{R6:()=>n,J4:()=>o});class n extends Error{get __isEffectionHaltError(){return!0}constructor(){super("halted")}}function o(e){var t;if(!(t=e)||!t.__isEffectionHaltError)throw e}},375:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AbortSignal:()=>L.AbortSignal,Effection:()=>O,Future:()=>o.ol,Symbol:()=>l.m,all:()=>M,createAbortSignal:()=>j.O,createFuture:()=>o.NO,createTask:()=>b,deprecated:()=>T,ensure:()=>A,label:()=>D,race:()=>B,run:()=>R,setLabels:()=>i.Uu,sleep:()=>S,spawn:()=>k.C,timeout:()=>N,withLabels:()=>i.rh,withTimeout:()=>P});var n=r(857),o=r(768),i=r(422);function s(e,t,r){let n,{produce:s,future:a}=(0,o.NO)();return{get type(){return n?"promise"===n.type?"async function":`${n.type} function`:"function"},get operation(){return null==n?void 0:n.operation},get resourceTask(){return null==n?void 0:n.resourceTask},future:a,start:function(){try{n=r(),e.setLabels({...(0,i.T_)(n.operation),...(0,i.T_)(t)})}catch(e){return void s({state:"errored",error:e})}n.future.consume((e=>{s(e)})),n.start()},halt:function(){null==n||n.halt()}}}const a=Symbol.for("effection/v2/iterator-controller/claimed");function u(e,t){let{future:r,produce:n}=(0,o.NO)();return{start:function(){t.consume(n)},halt:function(){n({state:"halted"})},future:r,type:"future",operation:t}}var l=r(315);function c(e,t,r){return(0,n.w_)(t)?s(e,t,(()=>c(e,t[l.m.operation],r))):"function"==typeof t?s(e,t,(()=>c(e,t(e),r))):t?(0,n.T$)(t)?function(e,t){let r,n,{scope:i}=e.options,{produce:s,future:a}=(0,o.NO)();return{type:"resource constructor",start:function(){var e;if(!i)throw new Error("cannot spawn resource in task which has no resource scope");let o=t.name||(null===(e=t.labels)||void 0===e?void 0:e.name)||"resource",a=t.labels||{};r=i.run(void 0,{type:"resource",labels:{...a,name:o}}),n=r.run((e=>t.init(r,e)),{yieldScope:r,labels:{name:"init"},ignoreError:!0}),n.consume((e=>{"completed"!==e.state&&r.halt(),s(e)}))},halt:function(){null==r||r.halt()},future:a,get resourceTask(){return r},operation:t}}(e,t):(0,n.Al)(t)?u(0,t):(0,n.tI)(t)?function(e,t){let{produce:r,future:n}=(0,o.NO)();return{start:function(){Promise.race([t,n]).then((e=>{r({state:"completed",value:e})}),(e=>{r({state:"errored",error:e})}))},halt:function(){r({state:"halted"})},future:n,type:"promise",operation:t}}(0,t):(0,n.xD)(t)?function(e,t,r){let n,i=!1,{produce:s,future:u}=(0,o.NO)();function l(t){r.runLoop.run((()=>{let o;try{o=t()}catch(e){return void s({state:"errored",error:e})}o.done?s(i?{state:"halted"}:{state:"completed",value:o.value}):(n=b(o.value,{scope:e.options.yieldScope||e,ignoreError:!0}),n.consume(c),n.start(),r.onYieldingToChange&&r.onYieldingToChange(n))}))}function c(e){n=void 0,r.onYieldingToChange&&r.onYieldingToChange(void 0),"completed"===e.state&&l((()=>t.next(e.value))),"errored"===e.state&&l((()=>t.throw(e.error))),"halted"===e.state&&l((()=>t.return(void 0)))}return{start:function(){if(t[a]){let e=new Error("An operation iterator can only be run once in a single task, but it looks like has been either yielded to, or run multiple times");e.name="DoubleEvalError",s({state:"errored",error:e})}else t[a]=!0,l((()=>t.next()))},halt:function(){i||(i=!0,n?n.halt():l((()=>t.return(void 0))))},future:u,type:"generator",operation:t}}(e,t,r):u(0,o.ol.reject(new Error(`unkown type of operation: ${t}`))):function(){let{produce:e,future:t}=(0,o.NO)();return{start:function(){},halt:function(){e({state:"halted"})},future:t,type:"suspend",operation:void 0}}()}var f=r(934),d=r(187);function h(e){return JSON.stringify(e)}class p{constructor(e){this.emitter=e,this.current="pending"}transition(e,t){let r=this.current,n=t[r];if(!n){let n=Object.keys(t).map(h).join(", ");throw new Error(`INTERNAL ERROR: state transition ${h(e)} is not valid in current state ${h(r)}, should be one of ${n}`)}this.current=n,this.emitter.emit("state",{from:r,to:n})}get isFinalized(){return"errored"===this.current||"completed"===this.current||"halted"===this.current}start(){this.transition("start",{pending:"running"})}completing(){this.transition("completing",{running:"completing"})}erroring(){this.transition("erroring",{running:"erroring",completing:"erroring",halting:"erroring",erroring:"erroring"})}halting(){this.transition("halting",{running:"halting",completing:"halting",halting:"halting"})}finish(){this.transition("finish",{completing:"completed",erroring:"errored",halting:"halted"})}}function y(e,t){let r={id:t.id,type:t.type,labels:t.labels,state:t.state};return Object.create(e,{effectionTrace:{value:[...e.effectionTrace||[],r],enumerable:!0}})}var m=r(700);let v=0;function b(e,t={}){let r=++v,s=new Set,a=new d.EventEmitter;a.setMaxListeners(1e5);let u,l,h,g=new p(a),w=(0,m.u)(`task ${r}`),{produce:E,future:_}=(0,o.EG)(w),x={...(0,i.T_)(e),...t.labels};x.name||(!(0,n.w_)(e)&&(null==e?void 0:e.name)?x.name=null==e?void 0:e.name:e||(x.name="suspend"));let O={id:r,options:t,future:_,get labels(){return x},get state(){return g.current},get type(){return t.type||l.type},get children(){return Array.from(s)},get yieldingTo(){return h},get resourceTask(){return l.resourceTask},catchHalt:()=>_.catch(f.J4),setLabels(e){x={...x,...e},a.emit("labels",x)},run(e,t={}){if("running"!==g.current)throw new Error("cannot spawn a child on a task which is not running");let r=b(e,{scope:O,...t});return T(r),r.start(),r},spawn:(e,t={})=>({name:"spawn",*init(){return O.run(e,t)}}),start(){w.run((()=>{"pending"===g.current&&(g.start(),l.start())}))},async halt(){l.halt(),"running"===g.current&&(g.halting(),u={state:"halted"}),j(!0),await _.catch((()=>{}))},toJSON:()=>({id:r,type:O.type,labels:x,state:g.current,yieldingTo:null==h?void 0:h.toJSON(),children:Array.from(s).map((e=>e.toJSON()))}),toString(){let e=Object.entries(x).filter((([e])=>"name"!==e&&"expand"!==e)).map((([e,t])=>`${e}=${JSON.stringify(t)}`)).join(" ");return[[x.name||"task",e,`[${O.type} ${r}]`].filter(Boolean).join(" "),h&&h.toString().split("\n").map((e=>"┃ "+e)).join("\n").replace(/^┃ /,"┣ yield "),...Array.from(s).map((e=>e.toString().split("\n").map((e=>"┃ "+e)).join("\n").replace(/^┃/,"┣")))].filter(Boolean).join("\n")},on:(...e)=>a.on(...e),off:(...e)=>a.off(...e),then:(...e)=>_.then(...e),catch:(...e)=>_.catch(...e),finally:(...e)=>_.finally(...e),consume:(...e)=>_.consume(...e),[Symbol.toStringTag]:`[Task ${r}]`};function T(e){s.has(e)||(e.consume((r=>{w.run((()=>{g.isFinalized||("errored"!==r.state||e.options.ignoreError||t.ignoreChildErrors||(g.erroring(),u={state:"errored",error:y(r.error,O)},l.halt(),j(!0)),s.has(e)&&(s.delete(e),a.emit("unlink",e)),L())}))})),s.add(e),a.emit("link",e))}function j(e){l.future.consume((()=>{let t;!function r(){w.run((()=>{t=Array.from(s).reverse().find((r=>r!==t&&(e||!r.options.blockParent))),t&&(t.consume(r),t.halt())}))}()}))}function L(){0===Array.from(s).length&&"pending"!==l.future.state&&"pending"===_.state&&(g.finish(),E(u))}return l=c(O,e,{runLoop:w,onYieldingToChange(e){h=e,a.emit("yieldingTo",e)}}),l.future.consume((e=>{g.isFinalized||("completed"===e.state?(g.completing(),u||(u={state:"completed",value:e.value}),j(!1)):"errored"===e.state?(g.erroring(),u={state:"errored",error:y(e.error,O)},j(!0)):"halted"===e.state&&"erroring"!==g.current&&(g.halting(),u={state:"halted"},j(!0)),L())})),O}const g=JSON.parse('{"_from":"@effection/core@2.2.0","_id":"@effection/core@2.2.0","_inBundle":false,"_integrity":"sha512-1RBMrDS0Ya02NEM0TQQRwzlGDSZmwoHhuD3qmWp9NLjZowhO1gJBZ16fQL2NbKvcpS71xho+oZsDedId+C1q8Q==","_location":"/@effection/core","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"@effection/core@2.2.0","name":"@effection/core","escapedName":"@effection%2fcore","scope":"@effection","rawSpec":"2.2.0","saveSpec":null,"fetchSpec":"2.2.0"},"_requiredBy":["/@effection/channel","/@effection/events","/@effection/fetch","/@effection/main","/@effection/stream","/@effection/subscription","/effection"],"_resolved":"https://registry.npmjs.org/@effection/core/-/core-2.2.0.tgz","_shasum":"4d11d7948144aecd70a26daf8abaa29ee89bc259","_spec":"@effection/core@2.2.0","_where":"/Users/pdubroy/dev/rollup-fun/node_modules/effection","bugs":{"url":"https://github.com/thefrontside/effection/issues"},"bundleDependencies":false,"dependencies":{"abort-controller":"^3.0.0"},"deprecated":false,"description":"[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) [![Created by Frontside](https://img.shields.io/badge/created%20by-frontside-26abe8.svg)](https://frontside.com) [![Chat on Discord](https://img.shields.io/discord/700803887132704931?Label=Discord)](https://discord.gg/Ug5nWH8)","devDependencies":{"@frontside/tsconfig":"^1.2.0","@types/mocha":"^7.0.2","@types/node":"^16.3.2","eslint":"^7.30.0","expect":"^25.3.0","mocha":"^8.3.1","rimraf":"^3.0.2","ts-node":"^10.4.0","typescript":"^4.3.5"},"files":["CHANGELOG.md","dist-*/**/*","src/**/*"],"homepage":"https://frontside.com/effection","license":"MIT","main":"dist-cjs/index.js","module":"dist-esm/index.js","name":"@effection/core","repository":{"type":"git","url":"git+https://github.com/thefrontside/effection.git","directory":"packages/core"},"scripts":{"build":"yarn prepack","clean":"rimraf *.tsbuildinfo dist","lint":"eslint \'{src,bin,test}/**/*.ts\'","mocha":"mocha -r ts-node/register","prepack":"tsc --build tsconfig.esm.json && tsc --build tsconfig.cjs.json","test":"mocha -r ts-node/register \'test/**/*.test.ts\'"},"sideEffects":false,"typeDocEntry":"src/index.ts","types":"dist-esm/index.d.ts","version":"2.2.0","volta":{"extends":"../../package.json"}}'),{version:w}=g,E=`__effectionV${w.split(".")[0]}`;function _(){let e=b(void 0,{ignoreChildErrors:!0,labels:{name:"root"}});return e.start(),e}function x(){return globalThis[E]||(globalThis[E]={root:_()}),globalThis[E]}const O={get root(){return x().root},set root(e){x().root=e},async reset(){await O.root.halt(),O.root=_()},async halt(){await O.root.halt()}};function T(e,t){return function(...r){try{throw new Error("trace")}catch(t){let[r]=t.stack.split("\n").slice(3,4);console.warn(e,"\n"+r)}return t.call(this,...r)}}var j=r(141),L=r(599);function S(e){return(0,i.rh)((t=>{let{future:r,resolve:n}=(0,o.NO)();if(null!=e){let r=setTimeout(n,e);t.consume((()=>clearTimeout(r)))}return r}),{name:"sleep",duration:null!=e?e:"forever"})}function A(e){return function(t){let{scope:r}=t.options;if(!r)throw new Error("cannot run `ensure` on a task without scope");return r.run((function*(){try{yield}finally{let t=e();t&&(yield t)}})),o.ol.resolve(void 0)}}class C extends Error{constructor(){super(...arguments),this.name="TimeoutError"}}function N(e){return(0,i.rh)((function*(){throw yield S(e),new C(`timed out after ${e}ms`)}),{name:"timeout",duration:e})}function B(e){return(0,i.rh)((function*(t){let{resolve:r,future:n}=(0,o.NO)(),i=[];for(let n of e)if("running"===t.state){let e=t.run(n,{ignoreError:!0,scope:t.options.scope});e.consume((()=>r(e))),i.push(e)}let s=yield n;for(let e of i)e!==s&&e.halt();return yield s}),{name:"race",count:e.length})}function P(e,t){return(0,i.Uu)(B([N(e),t]),{name:"withTimeout",duration:e})}var k=r(904);function M(e){return(0,i.rh)((function*(t){let r=[],n=[];try{yield function*(){for(let n of e)r.push(yield(0,k.C)(n,{scope:t.options.scope}));for(let e of r)n.push(yield e)}}catch(e){for(let e of r)e.halt();throw e}return n}),{name:"all",count:e.length})}function D(e){return(0,i.rh)((t=>{let{scope:r}=t.options;if(!r)throw new Error("cannot run `label` on a task without scope");return r.setLabels(e),o.ol.resolve(void 0)}),{name:"label"})}function R(e,t){return O.root.run(e,t)}},422:(e,t,r)=>{"use strict";r.d(t,{rh:()=>i,Uu:()=>s,T_:()=>a});var n=r(857),o=r(315);function i(e,t){if((0,n.w_)(e)){let r=e[o.m.operation];return Object.assign(e,{...t,[o.m.operation]:r})}return e&&(e.labels={...e.labels||{},...t}),e}function s(e,t){if((0,n.w_)(e)){let r=e[o.m.operation];e={...t,[o.m.operation]:r}}else e&&(e.labels=t);return e}function a(e){if(!(0,n.w_)(e))return{...(null==e?void 0:e.name)?{name:null==e?void 0:e.name}:null,...null==e?void 0:e.labels};let t={};for(let r in e){let n=e[r];"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n||(t[r]=n)}return t}},904:(e,t,r)=>{"use strict";r.d(t,{C:()=>o});var n=r(768);function o(e,t){return Object.assign((function(r){let{scope:o}=r.options;if(!o)throw new Error("cannot run `spawn` on a task without scope");let i=o.run(e,t);return n.ol.resolve(i)}),{within:function(r){return r.spawn(e,t)}})}},857:(e,t,r)=>{"use strict";r.d(t,{tI:()=>o,xD:()=>i,Al:()=>s,T$:()=>a,w_:()=>u});var n=r(315);function o(e){return e&&"function"==typeof e.then}function i(e){return e&&"function"==typeof e.next}function s(e){return e&&"function"==typeof e.consume}function a(e){return"object"==typeof e&&"function"==typeof e.init}function u(e){return"object"==typeof e&&null!=e&&n.m.operation in e}},700:(e,t,r)=>{"use strict";function n(e){let t=!1,r=[];return{run:function(n){if(r.push(n),!t){t=!0;try{for(;;){let t=r.shift();if(!t)break;try{t()}catch(t){console.error(`Caught error in run loop \`${e}\`:`),console.error(t)}}}finally{t=!1}}}}}r.d(t,{u:()=>n})},315:(e,t,r)=>{"use strict";r.d(t,{m:()=>n});const n=Object.create(Symbol,{operation:{writable:!1,enumerable:!1,configurable:!1,value:Symbol.for("Symbol.operation")}})},773:(e,t,r)=>{"use strict";function n(e){return"function"==typeof e.addEventListener}function o(e,t,r){n(e)?e.addEventListener(t,r):e.on(t,r)}function i(e,t,r){n(e)?e.removeEventListener(t,r):e.off(t,r)}r.d(t,{N:()=>o,y:()=>i})},818:(e,t,r)=>{"use strict";r.d(t,{on:()=>u.on,ps:()=>u.p,IH:()=>s,yE:()=>a,UH:()=>l});var n=r(422),o=r(768),i=r(773);function s(e,t){return(0,n.rh)((r=>{let{future:n,resolve:s}=(0,o.NO)(),a=(...e)=>{s(e[0])};return(0,i.N)(e,t,a),r.consume((()=>(0,i.y)(e,t,a))),n}),{name:"once",eventName:t,source:e.toString()})}function a(e,t){return(0,n.rh)((r=>{let{future:n,resolve:s}=(0,o.NO)(),a=(...e)=>{s(e)};return(0,i.N)(e,t,a),r.consume((()=>(0,i.y)(e,t,a))),n}),{name:"onceEmit",eventName:t,source:e.toString()})}var u=r(757);function*l(e){throw yield s(e,"error")}},757:(e,t,r)=>{"use strict";r.d(t,{on:()=>s,p:()=>a});var n=r(422),o=r(304),i=r(773);function s(e,t,r=`on('${t}')`){return(0,o.C)((r=>(0,n.rh)((function*(){(0,i.N)(e,t,r);try{yield}finally{(0,i.y)(e,t,r)}}),{name:"listen",eventName:t,source:e.toString()})),r)}function a(e,t,r=`onEmit('${t}')`){return(0,o.C)((r=>(0,n.rh)((function*(){let n=(...e)=>r(e);(0,i.N)(e,t,n);try{yield}finally{(0,i.y)(e,t,n)}}),{name:"listen",eventName:t,source:e.toString()})),r)}},787:(e,t,r)=>{"use strict";r.d(t,{h:()=>s});var n=r(141),o=r(422),i=r(98);function s(e,t={}){function*r(){let r=yield(0,n.O)();return t.signal=r,yield(0,i.fetch)(e,t)}let s=`fetch('${e}')`,a={expand:!1,method:t.method||"GET"};return{name:s,labels:a,init:r,arrayBuffer:()=>(0,o.rh)((function*(){let e=yield{init:r};return yield e.arrayBuffer()}),{name:`${s}.arrayBuffer()`,...a}),blob:()=>(0,o.rh)((function*(){let e=yield{init:r};return yield e.blob()}),{name:`${s}.blob()`,...a}),formData:()=>(0,o.rh)((function*(){let e=yield{init:r};return yield e.formData()}),{name:`${s}.formData()`,...a}),json:()=>(0,o.rh)((function*(){let e=yield{init:r};return yield e.json()}),{name:`${s}.json()`,...a}),text:()=>(0,o.rh)((function*(){let e=yield{init:r};return yield e.text()}),{name:`${s}.text()`,...a})}}},842:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.main=void 0;const i=r(375),s=r(692);o(r(692),t),t.main=function(e){return i.run((function*(t){let r=()=>{t.halt()};try{window.addEventListener("unload",r);let t=(null==e?void 0:e.name)||"entry point";return yield i.withLabels(e,{name:"string"==typeof t?t:"entry point"})}catch(e){if(!s.isMainError(e))throw console.error(e),e;e.message&&console.error(e.message)}finally{window.removeEventListener("unload",r)}}),{labels:{name:"main",platform:"browser"}})}},692:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isMainError=t.MainError=void 0;class r extends Error{constructor(e={}){super(e.message||""),this.name="EffectionMainError",this.exitCode=e.exitCode||-1}}t.MainError=r,t.isMainError=function(e){return"EffectionMainError"===e.name}},333:(e,t,r)=>{"use strict";r.d(t,{C:()=>n.C});var n=r(304)},304:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});var n=r(852),o=r(904);function i(e){return t=>{if("object"==typeof t&&"object"==typeof e){let r=t,n=e;return Object.entries(n).every((([e,t])=>i(t)(r[e])))}return t===e}}function s(e,t="stream"){let r=r=>{let o=(0,n.j)(t);return r.run((function*(){let t=yield e(o.send);o.closeWith(t)}),{labels:{name:"publisher",expand:!1}}),o.subscription},a={subscribe:r,filter:function(e){return s((t=>a.forEach((r=>function*(){e(r)&&t(r)}))),`${t}.filter()`)},*init(e){return r(e)},match:e=>a.filter(i(e)),grep:e=>"string"==typeof e?a.filter((t=>String(t).includes(e))):a.filter((t=>!!String(t).match(e))),map:e=>s((t=>a.forEach((r=>function*(){t(e(r))}))),`${t}.map()`),first:()=>e=>r(e).first(),expect:()=>e=>r(e).expect(),forEach:e=>t=>r(t).forEach(e),join:()=>e=>r(e).join(),collect:()=>e=>r(e).collect(),toArray:()=>e=>r(e).toArray(),toBuffer:(e=1/0)=>({name:`${t}.buffer(${e})`,*init(){let t=function(e=1/0){return e===1/0?new Array:function(e){let t=0,r=[];return{push(n){r[t]=n,t+=1,t>=e&&(t=0)},*[Symbol.iterator](){for(let e=0;e<r.length;e++)yield r[(e+t)%r.length]}}}(e)}(e);return yield(0,o.C)(a.forEach((e=>{t.push(e)}))),t}}),buffered:(e=1/0)=>({*init(){let r=yield a.toBuffer(e);return s((e=>function*(){for(let t of r)e(t);return yield a.forEach(e)}),`${t}.buffered(${e})`)}})};return a}},19:(e,t,r)=>{"use strict";r.d(t,{j:()=>n.j});var n=r(852)},852:(e,t,r)=>{"use strict";r.d(t,{j:()=>i});var n=r(422),o=r(768);function i(e="queue"){let t=[],r=[],i=e=>{let n=t.pop();n?n({value:e,done:!0}):r.push({value:e,done:!0})},s=()=>(0,n.rh)((e=>{let{future:n,resolve:i}=(0,o.NO)();return r.length?i(r.shift()):(t.push(i),e.consume((()=>{let e=t.indexOf(i);e>-1&&t.splice(e,1)}))),n}),{name:`${e}.next()`});function a(t,r){return(0,n.rh)(r,{name:`${e}.${t}()`,expand:!1})}let u={next:s,close:(...e)=>i(e[0]),closeWith:i,first:()=>a("first",(function*(){let e=yield s();return e.done?void 0:e.value})),expect:()=>a("expect",(function*(){let e=yield s();if(e.done)throw new Error("expected to contain a value");return e.value})),forEach:e=>a("forEach",(function*(){for(;;){let t=yield s();if(t.done)return t.value;{let r=e(t.value);r&&(yield r)}}})),join:()=>a("join",u.forEach((()=>{}))),collect:()=>a("collect",(function*(){let e=[],t=yield u.forEach((t=>function*(){e.push(t)}));return function*(){return yield*e,t}()})),toArray:()=>a("toArray",(function*(){return Array.from(yield u.collect())}))};return{send:e=>{let n=t.pop();n?n({value:e,done:!1}):r.push({value:e,done:!1})},subscription:u,...u}}},599:e=>{"use strict";const{AbortController:t,AbortSignal:r}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;e.exports=t,e.exports.AbortSignal=r,e.exports.default=t},98:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function y(e){var t=new FileReader,r=p(t);return t.readAsArrayBuffer(e),r}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&o&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,r,n=h(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=p(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=l(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[l(e)]},d.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},d.prototype.set=function(e,t){this.map[l(e)]=c(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),f(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),f(e)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function g(e,t){var r,n,o=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),b.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function E(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},v.call(g.prototype),v.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var e=new E(null,{status:0,statusText:""});return e.type="error",e};var _=[301,302,303,307,308];E.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new E(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function x(e,r){return new Promise((function(n,i){var s=new g(e,r);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;n(new E(o,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&o&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",u)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}x.polyfill=!0,e.fetch||(e.fetch=x,e.Headers=d,e.Request=g,e.Response=E),t.Headers=d,t.Request=g,t.Response=E,t.fetch=x,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;(t=o.fetch).default=o.fetch,t.fetch=o.fetch,t.Headers=o.Headers,t.Request=o.Request,t.Response=o.Response,e.exports=t},399:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AbortSignal:()=>n.AbortSignal,Effection:()=>n.Effection,Future:()=>n.Future,Symbol:()=>n.Symbol,all:()=>n.all,createAbortSignal:()=>n.createAbortSignal,createFuture:()=>n.createFuture,createTask:()=>n.createTask,deprecated:()=>n.deprecated,ensure:()=>n.ensure,label:()=>n.label,race:()=>n.race,run:()=>n.run,setLabels:()=>n.setLabels,sleep:()=>n.sleep,spawn:()=>n.spawn,timeout:()=>n.timeout,withLabels:()=>n.withLabels,withTimeout:()=>n.withTimeout,createChannel:()=>s.m,on:()=>a.on,onEmit:()=>a.ps,once:()=>a.IH,onceEmit:()=>a.yE,throwOnErrorEvent:()=>a.UH,fetch:()=>u.h,createQueue:()=>l.j,createStream:()=>c.C});var n=r(375),o=r(842),i={};for(const e in o)["default","AbortSignal","Effection","Future","Symbol","all","createAbortSignal","createFuture","createTask","deprecated","ensure","label","race","run","setLabels","sleep","spawn","timeout","withLabels","withTimeout"].indexOf(e)<0&&(i[e]=()=>o[e]);r.d(t,i);var s=r(734),a=r(818),u=r(787),l=r(19),c=r(333)},187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(r,n){function o(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),r([].slice.call(arguments))}y(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var o,i,s,l;if(a(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"==typeof s?s=i[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=u(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,l=c,console&&console.warn&&console.warn(l)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=c.bind(n);return o.listener=r,n.wrapFn=o,o}function d(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):p(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){n.once&&e.removeEventListener(t,o),r(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)n(u,this,t);else{var l=u.length,c=p(u,l);for(r=0;r<l;++r)n(c[r],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,f(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,o,i,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(220)})()}));